# Parallel Merge Sort (pthreads)

**Authors:** Nguyen Do Nhat Hoang, Ngo Minh Tuan, Sebastian Lien  
**Group name:** Group 108

## Overview

This project implements a **parallel merge sort** in C using **POSIX threads (pthreads)**. Given an input size `n`, a depth **cutoff** for thread spawning, and a RNG seed, the program:

1) generates a random array `A` of `n` integers,  
2) sorts it using either serial or parallel merge sort (depending on `cutoff`), and  
3) reports wall-clock time.

Parallelism follows a **divide-and-conquer fork–join** pattern: each task splits its range, spawns two child threads while `level < cutoff`, waits (`pthread_join`), then merges the two sorted halves. No mutexes are needed because subranges are disjoint and merges happen only after joins.

---

## Manifest

- **`mergesort.h`** – Public header (globals `A`, `B`, `cutoff`; `struct argument`; prototypes).
- **`mergesort.c`** – Implements merge (stable merge to B then memcpy back), my_mergesort (serial), parallel_mergesort (depth-bounded pthread fork–join), and buildArgs.
- **`test-mergesort.c`** – Official harness (allocates `A/B`, parses args, times runs, validates sortedness).
- **`test-parallel-mergesort.c`** Simple custom harness for local experiments.
- **`Makefile`** – Builds `test-mergesort` (and optionally `test-parallel-mergesort`).
- **`README.md`** – Project overview, build/use instructions, testing notes, bugs, reflection, and sources.

---

## Building

Requirements: `gcc`, `make`, and pthreads (Linux/macOS; on Windows use WSL).

```bash
make                # builds ./test-mergesort
# optionally:
make test-parallel-mergesort
```

If you see `Permission denied` when running an executable, ensure it’s built and executable:

```bash
make clean && make
# or
chmod +x ./test-mergesort
```

**Sanitizers (optional):**
```bash
make clean
CFLAGS='-Wall -Wextra -O2 -fsanitize=address,undefined -g -pthread' make
```

---

## Usage

**Executable:** `./test-mergesort <n> <cutoff> <seed>`

Examples:
```bash
# Serial baseline (no extra threads)
./test-mergesort 1000000 0 1234

# Parallel with one level (2 workers at the leaves)
./test-mergesort 1000000 1 1234

# Deeper fork-join
./test-mergesort 1000000 3 1234
```

Key behaviors:
- **Stable merge**: uses `A[i] <= A[j]` to preserve equal-key order.
- **Depth cutoff**: when `level >= cutoff`, the branch switches to `my_mergesort` (serial) — prevents thread explosion.
- **Memory model**: `A` and `B` are global and allocated once; `merge` writes into `B` then bulk-copies back to `A` via `memcpy` over the merged span.
- **Ownership**: Each *child* thread frees its own `struct argument` before returning (`if (level > 0) free(a);`). The *root* argument is freed by the harness, which prevents double-free.

---

## Quick sanity tests (copy-paste)

```bash
# --- Smoke (tiny arrays) ---
./test-mergesort 2 0 1
./test-mergesort 3 1 1
./test-mergesort 10 0 7
./test-mergesort 10 2 7

# --- Small/functional ---
./test-mergesort 100 0 1234
./test-mergesort 100 1 1234
./test-mergesort 1000 2 1234

# --- Medium perf sanity ---
./test-mergesort 100000 0 42
./test-mergesort 100000 1 42
./test-mergesort 100000 2 42
./test-mergesort 100000 3 42
./test-mergesort 100000 4 42

# --- Larger (ensure enough RAM; avoid printing arrays during timing) ---
./test-mergesort 1000000 0 1234
./test-mergesort 1000000 1 1234
./test-mergesort 1000000 2 1234
./test-mergesort 1000000 3 1234
./test-mergesort 1000000 4 1234
```
**From terminal:**

**Array A**: 289383 930886 0 0 0 0 33 0 289383 930886 0 0 0 0 33 0 0 1 0 0 0 0 1041 0 1634890305 977346681 959984160 540227635 942682937 807417400 807415840 857747488 540024883 859387954 958411576 943206451 540024886 540024880 858988592 807415840 807416096 807415840 824193056 540095536 909189168 959984691 892351280 926365984 909521971 958411064 943274293 808857908 808727840 909586994 958412083 943075892 926103858 925906976 876032308 941633584 825505584 808728629 926234656 876033079 891303992 842018868 859322420 959789088 959920179 958411829 825505845 909587761 859060512 875966514 891302197 842018868 909654068 808727840 942944816 941633592 943274037 842609976 925906976 943010100 941633588 825505584 909717558 925906976 943010100 941633588 959525938 909455411 808727840 892680496 958412339 942750000 943075641 959789344 909391929 941633849 
**Array B**: 289383 930886 0 0 0 0 33 0 0 1 0 0 0 0 1041 0 1634890305 977412217 959984160 540227635 942682937 807417400 807415840 857747488 540024883 540090416 540024880 540024880 825503793 824193056 942945078 808661049 926490677 842085431 540487986 960050489 909194296 875896880 926036528 540357430 909259833 859386424 808984631 925971511 540028980 876032056 876098865 892870704 926168887 540555316 808465461 943207474 875896883 809054256 540422452 808465461 943207474 875896880 875704368 540031032 892678712 959918896 842539059 859386164 540423472 959591481 925906228 808984632 825636408 540619824 875967033 926298169 876093495 892874802 540095284 875574325 943273784 909713462 808792112 540620852 825831481 959591481 926425142 909719605 540031032 808858169 842348083 875896888 926233392 540029748 842608697 859322677 892870707 909652793 540291636 959983672 859190328 842604593 825702709 540094773 
Sorting 2 elements took 0.00 seconds. 

**Array A**: 289383 692777 930886 0 0 0 33 0 289383 692777 930886 0 0 0 33 0 0 2 0 0 0 0 65 0 -1715360496 30941 -1715360496 30941 0 0 33 0 -1715360544 30941 -1715360544 30941 64 0 288 0 15 0 0 0 1 0 0 0 -1717570128 30941 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 
**Array B**: 289383 692777 930886 0 0 0 33 0 0 2 0 0 0 0 65 0 -1715360496 30941 -1715360496 30941 0 0 33 0 -1715360544 30941 -1715360544 30941 64 0 288 0 15 0 0 0 1 0 0 0 -1717570128 30941 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 
Sorting 3 elements took 0.00 seconds. 

**Array A**: 85871 564443 574097 579899 618677 782586 851600 852153 961325 967299 49 0 85871 564443 574097 579899 618677 782586 851600 852153 961325 967299 33 0 0 9 0 0 0 0 1041 0 1634890305 977346681 943011872 891302199 875836470 926228531 926494772 959919392 540621112 909652278 924858167 943010360 892870710 808465969 842348576 540226865 858863161 958412082 959592246 959717433 941633568 825702453 875967776 540226612 808728373 891303737 959985975 825630777 926365240 842544928 540424245 909194552 941633584 892416565 909713459 892482353 926300448 540621106 807416627 958410784 807415840 807415840 875573536 540024881 875771441 858798392 958412080 875771703 825767478 859060512 942747952 941634103 808661305 960049458 892811296 875967288 958410807 842151474 825439544 909261088 926169396 958411319 825833781 842609465 808727840 825307702 958411313 892746032 
**Array B**: 85871 564443 574097 579899 618677 782586 851600 852153 961325 967299 33 0 0 9 0 0 0 0 1041 0 1634890305 977412217 943011872 891302199 875836470 926228531 926494772 959919392 540621112 909652278 924858167 943010360 892870710 808465969 842348576 540226865 858863161 958412082 959592246 858988601 807415840 807418144 807415840 824193056 540095536 909189168 959984691 892351280 926365984 842150196 958412593 825242420 842479665 825833504 825372723 941635897 859321655 808924214 909261088 892875314 958411059 959723058 842479412 959789344 859386169 891302457 842412084 842084657 959461664 842151222 958412855 892875826 926298424 859060512 858796336 941633590 926429753 808531760 942684192 959788596 941635894 875770420 909587768 808727840 943075890 941634870 909654069 825635123 943012128 808595764 958411320 959789365 909390386 943011872 909654073 941633840 825505584 808728629 925906976 825766196 Sorting 10 elements took 0.00 seconds. 

**Array A**: 85871 564443 574097 579899 618677 782586 851600 852153 961325 967299 49 0 85871 564443 574097 579899 618677 782586 851600 852153 961325 967299 33 0 0 9 0 0 0 0 65 0 2120330512 29864 2120330512 29864 0 0 33 0 2120330464 29864 2120330464 29864 64 0 288 0 15 0 0 0 1 0 0 0 2118120880 29864 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 
**Array B**: 85871 564443 574097 579899 618677 782586 851600 852153 961325 967299 33 0 0 9 0 0 0 0 65 0 2120330512 29864 2120330512 29864 0 0 33 0 2120330464 29864 2120330464 29864 64 0 288 0 15 0 0 0 1 0 0 0 2118120880 29864 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 
Sorting 10 elements took 0.00 seconds. 

**Array A**: 14630 31420 32879 32898 55827 60684 107662 122667 126155 131554 142414 164433 169303 170725 177076 183467 187728 188794 199408 200910 209601 219489 236636 250494 252683 271032 279201 280251 282698 283355 296571 306321 340067 347371 350634 368053 374504 379050 381964 387914 394075 429561 434858 450741 453246 464966 484666 492867 504834 506083 507901 512331 523935 526948 534375 545630 566339 569960 585285 586260 612487 621475 623652 630912 649615 654435 661225 672241 673596 675646 681055 689883 690901 693160 702060 702728 750169 758167 759233 759908 772636 781470 787572 792539 827736 837903 855346 862982 871003 874319 876532 879755 883107 885634 886067 892875 895185 920524 980168 998950 
**Array B**: 14630 31420 32879 32898 55827 60684 107662 122667 126155 131554 142414 164433 169303 170725 177076 183467 187728 188794 199408 200910 209601 219489 236636 250494 252683 271032 279201 280251 282698 283355 296571 306321 340067 347371 350634 368053 374504 379050 381964 387914 394075 429561 434858 450741 453246 464966 484666 492867 504834 506083 507901 512331 523935 526948 534375 545630 566339 569960 585285 586260 612487 621475 623652 630912 649615 654435 661225 672241 673596 675646 681055 689883 690901 693160 702060 702728 750169 758167 759233 759908 772636 781470 787572 792539 827736 837903 855346 862982 871003 874319 876532 879755 883107 885634 886067 892875 895185 920524 980168 998950 
Sorting 100 elements took 0.00 seconds. 

**Array A**: 14630 31420 32879 32898 55827 60684 107662 122667 126155 131554 142414 164433 169303 170725 177076 183467 187728 188794 199408 200910 209601 219489 236636 250494 252683 271032 279201 280251 282698 283355 296571 306321 340067 347371 350634 368053 374504 379050 381964 387914 394075 429561 434858 450741 453246 464966 484666 492867 504834 506083 507901 512331 523935 526948 534375 545630 566339 569960 585285 586260 612487 621475 623652 630912 649615 654435 661225 672241 673596 675646 681055 689883 690901 693160 702060 702728 750169 758167 759233 759908 772636 781470 787572 792539 827736 837903 855346 862982 871003 874319 876532 879755 883107 885634 886067 892875 895185 920524 980168 998950 
**Array B**: 14630 31420 32879 32898 55827 60684 107662 122667 126155 131554 142414 164433 169303 170725 177076 183467 187728 188794 199408 200910 209601 219489 236636 250494 252683 271032 279201 280251 282698 283355 296571 306321 340067 347371 350634 368053 374504 379050 381964 387914 394075 429561 434858 450741 453246 464966 484666 492867 504834 506083 507901 512331 523935 526948 534375 545630 566339 569960 585285 586260 612487 621475 623652 630912 649615 654435 661225 672241 673596 675646 681055 689883 690901 693160 702060 702728 750169 758167 759233 759908 772636 781470 787572 792539 827736 837903 855346 862982 871003 874319 876532 879755 883107 885634 886067 892875 895185 920524 980168 998950 
Sorting 100 elements took 0.00 seconds. 

**Array A**: 784 829 1564 3248 3336 5055 5325 6980 7104 11695 14192 14630 17224 18391 19037 19781 20398 22297 23474 23487 24965 25716 26395 26968 27040 28237 29878 30546 31420 31664 32578 32879 32898 35482 35883 35998 36719 37452 38203 39347 40778 42080 42480 43177 44785 45211 46805 47005 48607 48916 51134 51906 51936 54828 55827 56468 58020 59317 60072 60225 60684 61466 63392 64803 66295 67532 67701 67706 68170 68592 69301 70738 71403 72785 72967 73658 78216 78272 78755 79618 79831 80332 81750 85999 86347 88119 88628 89340 89619 90358 91296 91581 92778 92925 93122 93672 93673 94842 95084 96201 
**Array B**: 784 829 1564 3248 3336 5055 5325 6980 7104 11695 14192 14630 17224 18391 19037 19781 20398 22297 23474 23487 24965 25716 26395 26968 27040 28237 29878 30546 31420 31664 32578 32879 32898 35482 35883 35998 36719 37452 38203 39347 40778 42080 42480 43177 44785 45211 46805 47005 48607 48916 51134 51906 51936 54828 55827 56468 58020 59317 60072 60225 60684 61466 63392 64803 66295 67532 67701 67706 68170 68592 69301 70738 71403 72785 72967 73658 78216 78272 78755 79618 79831 80332 81750 85999 86347 88119 88628 89340 89619 90358 91296 91581 92778 92925 93122 93672 93673 94842 95084 96201 
Sorting 1000 elements took 0.00 seconds. 

**Array A**: 3 8 11 15 20 23 36 37 48 52 63 69 72 75 105 113 113 131 149 169 170 186 206 219 220 234 240 243 272 274 302 304 321 325 328 342 345 353 359 370 396 411 414 435 442 446 456 461 491 511 541 558 563 571 572 599 601 657 658 680 686 691 697 708 714 714 715 719 723 727 733 742 759 775 780 785 793 798 824 824 854 858 876 884 912 925 926 931 939 941 944 946 946 948 962 991 995 996 996 996 
**Array B**: 3 8 11 15 20 23 36 37 48 52 63 69 72 75 105 113 113 131 149 169 170 186 206 219 220 234 240 243 272 274 302 304 321 325 328 342 345 353 359 370 396 411 414 435 442 446 456 461 491 511 541 558 563 571 572 599 601 657 658 680 686 691 697 708 714 714 715 719 723 727 733 742 759 775 780 785 793 798 824 824 854 858 876 884 912 925 926 931 939 941 944 946 946 948 962 991 995 996 996 996 
Sorting 100000 elements took 0.02 seconds. 

**Array A**: 3 8 11 15 20 23 36 37 48 52 63 69 72 75 105 113 113 131 149 169 170 186 206 219 220 234 240 243 272 274 302 304 321 325 328 342 345 353 359 370 396 411 414 435 442 446 456 461 491 511 541 558 563 571 572 599 601 657 658 680 686 691 697 708 714 714 715 719 723 727 733 742 759 775 780 785 793 798 824 824 854 858 876 884 912 925 926 931 939 941 944 946 946 948 962 991 995 996 996 996 
**Array B**: 3 8 11 15 20 23 36 37 48 52 63 69 72 75 105 113 113 131 149 169 170 186 206 219 220 234 240 243 272 274 302 304 321 325 328 342 345 353 359 370 396 411 414 435 442 446 456 461 491 511 541 558 563 571 572 599 601 657 658 680 686 691 697 708 714 714 715 719 723 727 733 742 759 775 780 785 793 798 824 824 854 858 876 884 912 925 926 931 939 941 944 946 946 948 962 991 995 996 996 996 
Sorting 100000 elements took 0.02 seconds. 

**Array A**: 3 8 11 15 20 23 36 37 48 52 63 69 72 75 105 113 113 131 149 169 170 186 206 219 220 234 240 243 272 274 302 304 321 325 328 342 345 353 359 370 396 411 414 435 442 446 456 461 491 511 541 558 563 571 572 599 601 657 658 680 686 691 697 708 714 714 715 719 723 727 733 742 759 775 780 785 793 798 824 824 854 858 876 884 912 925 926 931 939 941 944 946 946 948 962 991 995 996 996 996 
**Array B**: 3 8 11 15 20 23 36 37 48 52 63 69 72 75 105 113 113 131 149 169 170 186 206 219 220 234 240 243 272 274 302 304 321 325 328 342 345 353 359 370 396 411 414 435 442 446 456 461 491 511 541 558 563 571 572 599 601 657 658 680 686 691 697 708 714 714 715 719 723 727 733 742 759 775 780 785 793 798 824 824 854 858 876 884 912 925 926 931 939 941 944 946 946 948 962 991 995 996 996 996 
Sorting 100000 elements took 0.01 seconds.

**Array A**: 3 8 11 15 20 23 36 37 48 52 63 69 72 75 105 113 113 131 149 169 170 186 206 219 220 234 240 243 272 274 302 304 321 325 328 342 345 353 359 370 396 411 414 435 442 446 456 461 491 511 541 558 563 571 572 599 601 657 658 680 686 691 697 708 714 714 715 719 723 727 733 742 759 775 780 785 793 798 824 824 854 858 876 884 912 925 926 931 939 941 944 946 946 948 962 991 995 996 996 996 
**Array B**: 3 8 11 15 20 23 36 37 48 52 63 69 72 75 105 113 113 131 149 169 170 186 206 219 220 234 240 243 272 274 302 304 321 325 328 342 345 353 359 370 396 411 414 435 442 446 456 461 491 511 541 558 563 571 572 599 601 657 658 680 686 691 697 708 714 714 715 719 723 727 733 742 759 775 780 785 793 798 824 824 854 858 876 884 912 925 926 931 939 941 944 946 946 948 962 991 995 996 996 996 
Sorting 100000 elements took 0.01 seconds. 

**Array A**: 0 2 3 3 3 5 7 8 10 11 12 12 14 15 17 18 19 20 21 21 22 23 24 28 29 29 29 32 32 32 33 34 35 36 37 37 37 38 39 39 40 40 45 45 45 46 46 47 48 48 50 51 52 52 53 55 59 59 60 60 61 62 63 63 65 65 66 69 70 71 71 72 72 73 73 73 75 75 75 76 81 81 82 83 84 85 85 86 89 89 90 90 91 92 92 92 92 93 93 95 
**Array B**: 0 2 3 3 3 5 7 8 10 11 12 12 14 15 17 18 19 20 21 21 22 23 24 28 29 29 29 32 32 32 33 34 35 36 37 37 37 38 39 39 40 40 45 45 45 46 46 47 48 48 50 51 52 52 53 55 59 59 60 60 61 62 63 63 65 65 66 69 70 71 71 72 72 73 73 73 75 75 75 76 81 81 82 83 84 85 85 86 89 89 90 90 91 92 92 92 92 93 93 95 
Sorting 1000000 elements took 0.29 seconds. 

**Array A**: 0 2 3 3 3 5 7 8 10 11 12 12 14 15 17 18 19 20 21 21 22 23 24 28 29 29 29 32 32 32 33 34 35 36 37 37 37 38 39 39 40 40 45 45 45 46 46 47 48 48 50 51 52 52 53 55 59 59 60 60 61 62 63 63 65 65 66 69 70 71 71 72 72 73 73 73 75 75 75 76 81 81 82 83 84 85 85 86 89 89 90 90 91 92 92 92 92 93 93 95 
**Array B**: 0 2 3 3 3 5 7 8 10 11 12 12 14 15 17 18 19 20 21 21 22 23 24 28 29 29 29 32 32 32 33 34 35 36 37 37 37 38 39 39 40 40 45 45 45 46 46 47 48 48 50 51 52 52 53 55 59 59 60 60 61 62 63 63 65 65 66 69 70 71 71 72 72 73 73 73 75 75 75 76 81 81 82 83 84 85 85 86 89 89 90 90 91 92 92 92 92 93 93 95 
Sorting 1000000 elements took 0.17 seconds. 

**Array A**: 0 2 3 3 3 5 7 8 10 11 12 12 14 15 17 18 19 20 21 21 22 23 24 28 29 29 29 32 32 32 33 34 35 36 37 37 37 38 39 39 40 40 45 45 45 46 46 47 48 48 50 51 52 52 53 55 59 59 60 60 61 62 63 63 65 65 66 69 70 71 71 72 72 73 73 73 75 75 75 76 81 81 82 83 84 85 85 86 89 89 90 90 91 92 92 92 92 93 93 95 
**Array B**: 0 2 3 3 3 5 7 8 10 11 12 12 14 15 17 18 19 20 21 21 22 23 24 28 29 29 29 32 32 32 33 34 35 36 37 37 37 38 39 39 40 40 45 45 45 46 46 47 48 48 50 51 52 52 53 55 59 59 60 60 61 62 63 63 65 65 66 69 70 71 71 72 72 73 73 73 75 75 75 76 81 81 82 83 84 85 85 86 89 89 90 90 91 92 92 92 92 93 93 95 
Sorting 1000000 elements took 0.09 seconds. 

**Array A**: 0 2 3 3 3 5 7 8 10 11 12 12 14 15 17 18 19 20 21 21 22 23 24 28 29 29 29 32 32 32 33 34 35 36 37 37 37 38 39 39 40 40 45 45 45 46 46 47 48 48 50 51 52 52 53 55 59 59 60 60 61 62 63 63 65 65 66 69 70 71 71 72 72 73 73 73 75 75 75 76 81 81 82 83 84 85 85 86 89 89 90 90 91 92 92 92 92 93 93 95 
**Array B**: 0 2 3 3 3 5 7 8 10 11 12 12 14 15 17 18 19 20 21 21 22 23 24 28 29 29 29 32 32 32 33 34 35 36 37 37 37 38 39 39 40 40 45 45 45 46 46 47 48 48 50 51 52 52 53 55 59 59 60 60 61 62 63 63 65 65 66 69 70 71 71 72 72 73 73 73 75 75 75 76 81 81 82 83 84 85 85 86 89 89 90 90 91 92 92 92 92 93 93 95 
Sorting 1000000 elements took 0.09 seconds. 

**Array A**: 0 2 3 3 3 5 7 8 10 11 12 12 14 15 17 18 19 20 21 21 22 23 24 28 29 29 29 32 32 32 33 34 35 36 37 37 37 38 39 39 40 40 45 45 45 46 46 47 48 48 50 51 52 52 53 55 59 59 60 60 61 62 63 63 65 65 66 69 70 71 71 72 72 73 73 73 75 75 75 76 81 81 82 83 84 85 85 86 89 89 90 90 91 92 92 92 92 93 93 95 
**Array B**: 0 2 3 3 3 5 7 8 10 11 12 12 14 15 17 18 19 20 21 21 22 23 24 28 29 29 29 32 32 32 33 34 35 36 37 37 37 38 39 39 40 40 45 45 45 46 46 47 48 48 50 51 52 52 53 55 59 59 60 60 61 62 63 63 65 65 66 69 70 71 71 72 72 73 73 73 75 75 75 76 81 81 82 83 84 85 85 86 89 89 90 90 91 92 92 92 92 93 93 95 
Sorting 1000000 elements took 0.10 seconds.
---

## Performance

**How to measure**
- Run each config 3–5× and average.
- Avoid printing arrays during timing (I/O dominates).
- Keep the machine otherwise idle for more stable numbers.

**Example timings on our machine (n = 1,000,000):**

| n        | cutoff | time (s) | speedup vs. cutoff=0 |
|----------|--------|----------|----------------------|
| 1,000,000| 0      | 0.29     | 1.00×               |
| 1,000,000| 1      | 0.17     | 1.71×               |
| 1,000,000| 2      | 0.09     | 3.22×               |
| 1,000,000| 3      | 0.09     | 3.22×               |
| 1,000,000| 4      | 0.10     | 2.90×               |

**Example timings on our machine (n = 100,000):**

| n       | cutoff | time (s) | speedup vs. cutoff=0 |
| ------- | ------ | -------- | -------------------- |
| 100,000 | 0      | 0.02     | 1.00×                |
| 100,000 | 1      | 0.02     | 1.00×                |
| 100,000 | 2      | 0.01     | 2.00×                |
| 100,000 | 3      | 0.01     | 2.00×                |


> Interpretation: parallelism helps up to a point; beyond that, thread overhead and oversubscription eat the gains.

**Memory note:** `n = 100,000,000` requires ~**762 MiB** for two `int` arrays (`A` and `B`)—ensure enough RAM and swap before attempting.

---

## Testing

**Correctness**
- Program validates sortedness and reports a failure if any `A[i] > A[i+1]`.
- Test cases: tiny (0/1/2), already sorted, reverse sorted, all equal, many duplicates, random.

**Concurrency**
- No shared-state races: each thread works on **disjoint** subranges of `A/B`. Merges happen only **after** both children `pthread_join`, so no mutex is required.

**Memory**
- Verified no leaks/double-frees with AddressSanitizer/Valgrind.
- Critical pattern: the **root** `arg` is freed by the harness; each **child** frees its *own* `arg`.

---

## Known Bugs / Limitations

- **Double-free if ownership is wrong**: Freeing the root `arg` inside `parallel_mergesort` leads to `free(): double free detected`. Fix: child threads free their own `arg` (`if (level > 0)`), the root is freed in `main`.
- **Thread creation failures**: If `pthread_create` fails on a branch, free any allocated `leftArg/rightArg` and fall back to `my_mergesort` on that branch.
- **Over-parallelization**: Large `cutoff` on few cores can be slower due to thread overhead/oversubscription.
- **Very large `n`**: Can exceed memory on low-RAM machines.

---

## Reflection and Self-Assessment

1) **Nguyen Do Nhat Hoang**
  I found the serial merge sort straightforward, but the **parallel** version forced me to internalize three things: (1) **ownership & lifetime** for per-thread arguments, (2) a second base case via **`level`/`cutoff`** to stop thread fan-out, and (3) when synchronization is actually unnecessary.

  **What I fixed/learned**
  - **Double-free crash** was caused by freeing the root `arg` inside the worker. The rule that clicked: *caller owns its arg; each callee owns its own arg*.
  - **Cutoff** prevents thread explosion and matches parallelism to core count.
  - **No mutexes needed**: work is on disjoint segments; `join` gives a happens-before for the merge.
  - **Midpoint** should be `left + (right - left)/2` to avoid precedence/overflow pitfalls.

  Once I framed the recursion tree as an **ownership tree** and used **cutoff** as the fan-out brake, the implementation became clean, leak-free, and consistently faster up to a sensible depth.

---

## Sources Used

- POSIX man pages: `pthread_create(3)`, `pthread_join(3)`, `memcpy(3)`
- Viblo articles (conceptual refresher on multithreading models):  
  - *Làm quen với multithreading trong C#* — https://viblo.asia/p/lam-quen-voi-multithreading-trong-c-qm6RWQYXGeJE  
  - *Tìm hiểu về xử lí đa luồng trong Java* — https://viblo.asia/p/tim-hieu-ve-xu-li-da-luong-trong-java-m68Z0xyQZkG
- Course materials: **Lecture 05 — Concurrency** (class slides/notes).
- AI assistance: drafting and technical review using ChatGPT (GPT-5 Thinking).
